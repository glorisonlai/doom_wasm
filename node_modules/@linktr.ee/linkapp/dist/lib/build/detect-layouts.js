import { existsSync } from 'node:fs';
import { join } from 'node:path';
/**
 * Detects layout files in the project's /app directory
 * Only expanded.tsx (or legacy sheet.tsx), featured.tsx, and featured-carousel.tsx are supported as layout entry points
 */
export function detectLayouts(projectPath) {
    const appDir = join(projectPath, 'app');
    if (!existsSync(appDir)) {
        return { layouts: [], hasLayout: false, hasExpanded: false, hasLegacySheet: false };
    }
    const layouts = [];
    const hasExpanded = existsSync(join(appDir, 'expanded.tsx'));
    const hasLegacySheet = existsSync(join(appDir, 'sheet.tsx'));
    // Prefer expanded.tsx, but fall back to sheet.tsx for backwards compatibility
    if (hasExpanded || hasLegacySheet) {
        const expandedFileName = hasExpanded ? 'expanded.tsx' : 'sheet.tsx';
        layouts.push({ name: 'expanded', fileName: expandedFileName, displayName: 'Expanded' });
    }
    // Supported featured layouts
    const supportedLayouts = [
        { name: 'featured', fileName: 'featured.tsx', displayName: 'Featured' },
        { name: 'featured-carousel', fileName: 'featured-carousel.tsx', displayName: 'FeaturedCarousel' },
    ];
    for (const layout of supportedLayouts) {
        const layoutPath = join(appDir, layout.fileName);
        if (existsSync(layoutPath)) {
            layouts.push(layout);
        }
    }
    const hasLayout = existsSync(join(appDir, 'layout.tsx')) || existsSync(join(appDir, 'layout.ts'));
    return {
        layouts,
        hasLayout,
        hasExpanded,
        hasLegacySheet,
    };
}
/**
 * Validates that required layout files exist
 */
export function validateLayouts(projectPath) {
    const detection = detectLayouts(projectPath);
    const errors = [];
    // expanded.tsx is always required (sheet.tsx supported for backwards compatibility)
    const hasExpanded = detection.layouts.some(l => l.name === 'expanded');
    if (!hasExpanded) {
        errors.push('app/expanded.tsx (or legacy app/sheet.tsx) is required. This is the default layout for your Link App.');
    }
    // Layout wrapper is optional - will be used if present
    return {
        valid: errors.length === 0,
        errors,
    };
}
//# sourceMappingURL=detect-layouts.js.map